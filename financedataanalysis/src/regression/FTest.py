import collections
import networkx as nx
import matplotlib.pyplot as plt
from matplotlib.pyplot import plot, title, xlabel, ylabel, savefig, legend
import sys
import pandas as pd
import numpy as np
import pickle
from scipy import stats


QmemodelrmaePath = "/home/achivuku/PycharmProjects/financedataanalysis/qmemodelrmae.pkl"
QmemodelrmsePath = "/home/achivuku/PycharmProjects/financedataanalysis/qmemodelrmse.pkl"
QmemodelurmaePath = "/home/achivuku/PycharmProjects/financedataanalysis/qmemodelurmae.pkl"
QmemodelurmsePath = "/home/achivuku/PycharmProjects/financedataanalysis/qmemodelurmse.pkl"

MsemodelrmaePath = "/home/achivuku/PycharmProjects/financedataanalysis/msemodelrmae.pkl"
MsemodelrmsePath = "/home/achivuku/PycharmProjects/financedataanalysis/msemodelrmse.pkl"
MsemodelurmaePath = "/home/achivuku/PycharmProjects/financedataanalysis/msemodelurmae.pkl"
MsemodelurmsePath = "/home/achivuku/PycharmProjects/financedataanalysis/msemodelurmse.pkl"


columns = ['AAPL_restricted', 'ABT_restricted', 'AEM_restricted', 'AFG_restricted', 'APA_restricted', 'B_restricted', 'CAT_restricted', 'IXIC_restricted', 'LAKE_restricted', 'MCD_restricted', 'MSFT_restricted', 'ORCL_restricted', 'SUN_restricted', 'T_restricted', 'UTX_restricted', 'WWD_restricted','AAPL_unrestricted', 'ABT_unrestricted', 'AEM_unrestricted', 'AFG_unrestricted', 'APA_unrestricted', 'B_unrestricted', 'CAT_unrestricted', 'IXIC_unrestricted', 'LAKE_unrestricted', 'MCD_unrestricted', 'MSFT_unrestricted', 'ORCL_unrestricted', 'SUN_unrestricted', 'T_unrestricted', 'UTX_unrestricted', 'WWD_unrestricted']
indexes = ['AAPL_prices', 'ABT_prices', 'AEM_prices', 'AFG_prices', 'APA_prices', 'B_prices', 'CAT_prices', 'IXIC_prices', 'LAKE_prices', 'MCD_prices', 'MSFT_prices', 'ORCL_prices', 'SUN_prices', 'T_prices', 'UTX_prices', 'WWD_prices']

qmemodelrmae = collections.defaultdict(dict)
qmemodelrmse = collections.defaultdict(dict)
qmemodelurmae = collections.defaultdict(dict)
qmemodelurmse = collections.defaultdict(dict)

msemodelrmae = collections.defaultdict(dict)
msemodelrmse = collections.defaultdict(dict)
msemodelurmae = collections.defaultdict(dict)
msemodelurmse = collections.defaultdict(dict)


with open(QmemodelrmaePath, 'rb') as handle:
    qmemodelrmae = pickle.load(handle)

# with open(QmemodelrmsePath, 'rb') as handle:
#     qmemodelrmse = pickle.load(handle)

with open(QmemodelurmaePath, 'rb') as handle:
    qmemodelurmae = pickle.load(handle)

# with open(QmemodelurmsePath, 'rb') as handle:
#     qmemodelurmse = pickle.load(handle)


with open(MsemodelrmaePath, 'rb') as handle:
    msemodelrmae = pickle.load(handle)

# with open(MsemodelrmsePath, 'rb') as handle:
#     msemodelrmse = pickle.load(handle)

with open(MsemodelurmaePath, 'rb') as handle:
    msemodelurmae = pickle.load(handle)

# with open(MsemodelurmsePath, 'rb') as handle:
#     msemodelurmse = pickle.load(handle)

df = pd.read_csv("/home/achivuku/Documents/financedataanalysis/pricesvolumes.csv")
cols = [1,2,3,4,6,8,10,12,14,16,18,20,21,22,23,24,26,28,30,32,33,34,36,38,40,42]
df.drop(df.columns[cols],axis=1,inplace=True)

# print(df[['WWD_prices']])
# sys.exit()

#qmemodelrmae = {'CAT_prices': {'LAKE_prices': 19.205559056101283, 'SUN_prices': 19.218854530184878, 'WWD_prices': 19.215366104225708, 'UTX_prices': 19.180149048449945, 'MCD_prices': 19.206985598296122, 'MSFT_prices': 19.221424860736125, 'ORCL_prices': 19.180376658720128, 'T_prices': 19.204294508890388}, 'APA_prices': {'LAKE_prices': 5.7584514524422437, 'SUN_prices': 5.7541227706896709, 'WWD_prices': 5.7591335552190648, 'T_prices': 5.7590264452828297, 'UTX_prices': 5.767062501813851, 'MCD_prices': 5.7594100626465545, 'MSFT_prices': 5.6686162805245592, 'ORCL_prices': 5.7592205617942058, 'B_prices': 5.754833067320531, 'CAT_prices': 5.7594521598878252}, 'SUN_prices': {'UTX_prices': 3.7850761718999326, 'T_prices': 3.8235217434128903, 'WWD_prices': 3.8255435167574414}, 'ABT_prices': {'LAKE_prices': 2.2049389103658839, 'APA_prices': 2.155419906915403, 'SUN_prices': 2.1468019320294749, 'WWD_prices': 1.9800979695288963, 'AEM_prices': 2.1698218479655149, 'T_prices': 2.2033986612083085, 'UTX_prices': 2.1688244171391906, 'AFG_prices': 2.2248364566977505, 'MSFT_prices': 2.1722148913963166, 'ORCL_prices': 2.1696760370840433, 'MCD_prices': 2.1676292463065754, 'B_prices': 2.1692243625915126, 'CAT_prices': 2.1692022940691777}, 'LAKE_prices': {'SUN_prices': 0.94402599537294674, 'WWD_prices': 0.9440784282933653, 'UTX_prices': 0.94400497620401824, 'MCD_prices': 0.94403566192178168, 'MSFT_prices': 0.94399833492204255, 'ORCL_prices': 0.94401997273264371, 'T_prices': 0.94400434852425574}, 'UTX_prices': {'WWD_prices': 14.231905200434666}, 'AEM_prices': {'LAKE_prices': 4.1646736805735074, 'APA_prices': 3.3386487995097838, 'SUN_prices': 3.6483609981786191, 'AFG_prices': 3.2854429170197132, 'WWD_prices': 3.6602927416757822, 'T_prices': 3.343673960991155, 'UTX_prices': 3.3397994234671002, 'MCD_prices': 3.2673763247097241, 'MSFT_prices': 3.2863030178095003, 'ORCL_prices': 3.3379766202440448, 'B_prices': 4.427591647353827, 'CAT_prices': 4.0143060054654391}, 'T_prices': {'UTX_prices': 1.7747480582567601, 'WWD_prices': 1.774789608226103}, 'AAPL_prices': {'LAKE_prices': 13.06590996536554, 'APA_prices': 12.728921558654386, 'SUN_prices': 12.81513218100554, 'ABT_prices': 12.825500969481624, 'WWD_prices': 11.644591073428883, 'AEM_prices': 12.78686757555195, 'T_prices': 13.040438281788546, 'UTX_prices': 12.785337288551082, 'AFG_prices': 12.085443860720964, 'MSFT_prices': 13.157636054045234, 'ORCL_prices': 12.814436392690622, 'MCD_prices': 12.138955830592735, 'B_prices': 13.663984862184213, 'CAT_prices': 11.286081954856325}, 'AFG_prices': {'LAKE_prices': 2.8914263064565224, 'APA_prices': 2.8066271900351532, 'SUN_prices': 2.5219881331998537, 'WWD_prices': 2.8469926553614, 'T_prices': 3.0113018571940904, 'UTX_prices': 2.8684329288457735, 'MCD_prices': 3.0320906707663942, 'MSFT_prices': 3.063460208543765, 'ORCL_prices': 2.8076129408443675, 'B_prices': 3.1040035702823814, 'CAT_prices': 2.8039333617765139}, 'MSFT_prices': {'ORCL_prices': 2.621190743976169, 'UTX_prices': 2.4921540624955121, 'WWD_prices': 2.4264311609704512, 'SUN_prices': 2.4079352765301474, 'T_prices': 2.4612351747899273}, 'ORCL_prices': {'UTX_prices': 1.3708341673308728, 'WWD_prices': 1.1241534931986941, 'SUN_prices': 1.1098476542366875, 'T_prices': 1.1243512996661118}, 'MCD_prices': {'SUN_prices': 4.9849234811620775, 'WWD_prices': 4.9450515373080384, 'UTX_prices': 4.9451769972159196, 'MSFT_prices': 4.7477419510386349, 'ORCL_prices': 4.9101077372731723, 'T_prices': 4.9529002320532705}, 'IXIC_prices': {'LAKE_prices': 431.39202745225697, 'APA_prices': 421.21791433695876, 'SUN_prices': 443.70006606158086, 'ABT_prices': 558.4200144250409, 'UTX_prices': 484.17550782845689, 'WWD_prices': 619.06548154743666, 'AEM_prices': 430.89779395807801, 'T_prices': 426.64695430581088, 'AAPL_prices': 108.87328353582645, 'AFG_prices': 387.9254679760902, 'MSFT_prices': 545.72614570567805, 'ORCL_prices': 430.89779395807801, 'MCD_prices': 542.90750884012459, 'CAT_prices': 566.39991231681472, 'B_prices': 427.17670012829353}, 'B_prices': {'LAKE_prices': 1.332223503262389, 'SUN_prices': 1.3322454901302563, 'WWD_prices': 1.3147632678349812, 'T_prices': 1.3318947552076352, 'UTX_prices': 1.5865024077346901, 'MCD_prices': 1.3322546687780643, 'MSFT_prices': 1.3322546687780643, 'ORCL_prices': 1.3322546687780643, 'CAT_prices': 1.3073783232495675}}
#qmemodelurmae = {'CAT_prices': {'LAKE_prices': 68.144352592518132, 'SUN_prices': 48.848957505568961, 'WWD_prices': 47.355077835781124, 'UTX_prices': 13.301002235661924, 'MCD_prices': 18.575532425774469, 'MSFT_prices': 47.851283563352098, 'ORCL_prices': 52.659910079856324, 'T_prices': 50.212934336942787}, 'APA_prices': {'LAKE_prices': 70.180116082484432, 'SUN_prices': 46.976271062115437, 'WWD_prices': 47.474407562555051, 'T_prices': 49.816412774877612, 'UTX_prices': 28.426074433170893, 'MCD_prices': 33.359975587932112, 'MSFT_prices': 48.575575448329154, 'ORCL_prices': 51.613037898493751, 'B_prices': 54.39787771810893, 'CAT_prices': 21.232538724413104}, 'SUN_prices': {'UTX_prices': 35.703021808699063, 'T_prices': 18.123470178616593, 'WWD_prices': 21.988969431359784}, 'ABT_prices': {'LAKE_prices': 18.859105802049825, 'APA_prices': 46.958611768834729, 'SUN_prices': 15.410999200858322, 'WWD_prices': 6.4340771668876702, 'AEM_prices': 18.675149307687299, 'T_prices': 8.7394500283633967, 'UTX_prices': 38.932597655252692, 'AFG_prices': 10.419162318909091, 'MSFT_prices': 5.8674034533157844, 'ORCL_prices': 5.7334410150066697, 'MCD_prices': 28.084829941294551, 'B_prices': 4.8308313600378101, 'CAT_prices': 39.563176393197253}, 'LAKE_prices': {'SUN_prices': 12.830067557914584, 'WWD_prices': 19.126419910106783, 'UTX_prices': 14.038251300886566, 'MCD_prices': 9.2747118482402726, 'MSFT_prices': 3.1886861670250988, 'ORCL_prices': 4.311431661306643, 'T_prices': 3.2742064700407139}, 'UTX_prices': {'WWD_prices': 48.67339256137025}, 'AEM_prices': {'LAKE_prices': 32.520017601461973, 'APA_prices': 34.156573668959872, 'SUN_prices': 25.647315101374208, 'AFG_prices': 23.473118676079643, 'WWD_prices': 19.196462793287889, 'T_prices': 20.31944406796125, 'UTX_prices': 27.417597941479652, 'MCD_prices': 26.85775335972605, 'MSFT_prices': 20.175815556719414, 'ORCL_prices': 21.262823697009118, 'B_prices': 19.98233940024781, 'CAT_prices': 29.674486726249743}, 'T_prices': {'UTX_prices': 46.339838494194879, 'WWD_prices': 5.9510443893133429}, 'AAPL_prices': {'LAKE_prices': 50.427293640336181, 'APA_prices': 44.623816227133759, 'SUN_prices': 47.984325782925474, 'ABT_prices': 36.87521453059577, 'WWD_prices': 30.984800281399995, 'AEM_prices': 39.585736393149382, 'T_prices': 39.870044932645911, 'UTX_prices': 25.04291157940634, 'AFG_prices': 27.830634103413502, 'MSFT_prices': 36.470818453520728, 'ORCL_prices': 35.918452857522404, 'MCD_prices': 19.816817803476372, 'B_prices': 38.540001643561069, 'CAT_prices': 29.461501466838364}, 'AFG_prices': {'LAKE_prices': 32.654341225218928, 'APA_prices': 42.976741696027368, 'SUN_prices': 24.76790540109273, 'WWD_prices': 10.821922302246094, 'T_prices': 18.322462333729064, 'UTX_prices': 31.335321743036406, 'MCD_prices': 25.79368925904916, 'MSFT_prices': 12.742290043051726, 'ORCL_prices': 18.131549132104013, 'B_prices': 17.94563522338867, 'CAT_prices': 27.620777974097557}, 'MSFT_prices': {'ORCL_prices': 9.4475470100352972, 'UTX_prices': 35.060816399568047, 'WWD_prices': 5.4238330429675532, 'SUN_prices': 15.946339261921402, 'T_prices': 10.385205900902841}, 'ORCL_prices': {'UTX_prices': 38.641070496802236, 'WWD_prices': 4.5466696521035983, 'SUN_prices': 16.62518463633419, 'T_prices': 8.9514604655745753}, 'MCD_prices': {'SUN_prices': 52.298197777442681, 'WWD_prices': 43.593700942494507, 'UTX_prices': 13.843497509426541, 'MSFT_prices': 45.141166387819773, 'ORCL_prices': 48.908415551279106, 'T_prices': 49.513376452876074}, 'IXIC_prices': {'LAKE_prices': 3222.2893573835786, 'APA_prices': 3156.5622619229985, 'SUN_prices': 3201.9122931985294, 'ABT_prices': 3204.1424345128676, 'UTX_prices': 3157.8609375000001, 'WWD_prices': 3199.8068621068219, 'AEM_prices': 3194.3949027267158, 'T_prices': 3201.2251895680147, 'AAPL_prices': 3180.9789324193221, 'AFG_prices': 3192.2691093494691, 'MSFT_prices': 3201.5580505770017, 'ORCL_prices': 3207.1765778186273, 'MCD_prices': 3162.0745321435866, 'CAT_prices': 3163.990566278595, 'B_prices': 3207.2613530177696}, 'B_prices': {'LAKE_prices': 17.68426595451006, 'SUN_prices': 14.443034731796365, 'WWD_prices': 6.5430169822343816, 'T_prices': 8.7418911703271807, 'UTX_prices': 23.417925701266022, 'MCD_prices': 25.606869561687795, 'MSFT_prices': 5.8630594677395287, 'ORCL_prices': 7.7077954560323478, 'CAT_prices': 29.909227657941432}}
#qmemodelrmse = {'CAT_prices': {'LAKE_prices': 428.07250665402881, 'SUN_prices': 428.60118926802494, 'WWD_prices': 428.48046133003982, 'UTX_prices': 427.09374792560254, 'MCD_prices': 428.12952051100388, 'MSFT_prices': 428.70162736481313, 'ORCL_prices': 427.10181812959559, 'T_prices': 428.02518023322608}, 'APA_prices': {'LAKE_prices': 60.912344316096089, 'SUN_prices': 60.829122789544996, 'WWD_prices': 60.925806158975838, 'T_prices': 60.923565049264944, 'UTX_prices': 61.080588072109848, 'MCD_prices': 60.930969195895727, 'MSFT_prices': 59.481345899120655, 'ORCL_prices': 60.927317054598937, 'B_prices': 60.842378463620456, 'CAT_prices': 60.931917333291246}, 'SUN_prices': {'UTX_prices': nan, 'T_prices': nan, 'WWD_prices': nan}, 'ABT_prices': {'LAKE_prices': 7.714040626575744, 'APA_prices': 7.4130118575750616, 'SUN_prices': 7.3612477022058824, 'WWD_prices': 6.4003235648660102, 'AEM_prices': 7.4980777565949879, 'T_prices': 7.7006183973324847, 'UTX_prices': 7.4924514920103782, 'AFG_prices': 7.8346738378986034, 'MSFT_prices': 7.5150795805688002, 'ORCL_prices': 7.497206803864124, 'MCD_prices': 7.4857810974121097, 'B_prices': 7.4945155174903624, 'CAT_prices': 7.4943839727663528}, 'LAKE_prices': {'SUN_prices': nan, 'WWD_prices': nan, 'UTX_prices': nan, 'MCD_prices': nan, 'MSFT_prices': nan, 'ORCL_prices': nan, 'T_prices': nan}, 'UTX_prices': {'WWD_prices': 249.26890390433516}, 'AEM_prices': {'LAKE_prices': 32.834521599065248, 'APA_prices': 21.507037385928086, 'SUN_prices': 25.543220574871388, 'AFG_prices': 20.752815146851383, 'WWD_prices': 25.800531551884671, 'T_prices': 21.576292085335925, 'UTX_prices': 21.524005022235944, 'MCD_prices': 20.50873776853474, 'MSFT_prices': 20.765727124183005, 'ORCL_prices': 21.496326865401922, 'B_prices': 36.488346030042059, 'CAT_prices': 30.554752599180134}, 'T_prices': {'UTX_prices': 5.9581778395409675, 'WWD_prices': 5.9583964179543889}, 'AAPL_prices': {'LAKE_prices': 215.21487171447356, 'APA_prices': 205.2409876206342, 'SUN_prices': 207.69436908796723, 'ABT_prices': 208.07033543804891, 'WWD_prices': 176.35067729077309, 'AEM_prices': 206.87917420630362, 'T_prices': 214.07197006325316, 'UTX_prices': 206.83703992257711, 'AFG_prices': 187.30703575782528, 'MSFT_prices': 217.18314950980391, 'ORCL_prices': 207.67470196493312, 'MCD_prices': 189.30583085203483, 'B_prices': 231.94403084150326, 'CAT_prices': 166.76089405732995}, 'AFG_prices': {'LAKE_prices': 13.927789476182726, 'APA_prices': 13.242616950141059, 'SUN_prices': 11.046310125612745, 'WWD_prices': 13.447538891960592, 'T_prices': 14.854994361229192, 'UTX_prices': 13.68977317560732, 'MCD_prices': 15.020222592821309, 'MSFT_prices': 15.216056050817951, 'ORCL_prices': 13.24941412732492, 'B_prices': 15.426155374564377, 'CAT_prices': 13.223587569691777}, 'MSFT_prices': {'ORCL_prices': 11.680362482008592, 'UTX_prices': 10.807067503336988, 'WWD_prices': 10.367689520393322, 'SUN_prices': 10.247262797636145, 'T_prices': 10.600463531843198}, 'ORCL_prices': {'UTX_prices': 4.2190438853369816, 'WWD_prices': 3.169893773708468, 'SUN_prices': 3.1020559161317114, 'T_prices': 3.1708371614319049}, 'MCD_prices': {'SUN_prices': 49.580284148571536, 'WWD_prices': 48.878502281039367, 'UTX_prices': 48.880712930517262, 'MSFT_prices': 45.39068595537173, 'ORCL_prices': 48.259918551974827, 'T_prices': 49.017343379001993}, 'IXIC_prices': {'LAKE_prices': 223495.63619281046, 'APA_prices': 214345.56650326797, 'SUN_prices': 234976.68402777778, 'ABT_prices': 357033.33039215684, 'UTX_prices': 274133.95330882352, 'WWD_prices': 432173.47933006537, 'AEM_prices': 223041.9330882353, 'T_prices': 219184.49975490195, 'AAPL_prices': 21278.550469771242, 'AFG_prices': 185930.57767565359, 'MSFT_prices': 342048.01866830065, 'ORCL_prices': 223041.9330882353, 'MCD_prices': 338801.0651143791, 'CAT_prices': 366825.09705882351, 'B_prices': 219652.41977124184}, 'B_prices': {'LAKE_prices': 3.6572764346802158, 'SUN_prices': 3.6572226200228424, 'WWD_prices': 3.6144549344879349, 'T_prices': 3.6564481473436543, 'UTX_prices': 4.735924950144649, 'MCD_prices': 3.6572591095968008, 'MSFT_prices': 3.6572591095968008, 'ORCL_prices': 3.6572591095968008, 'CAT_prices': 3.5825519418404772}}
#qmemodelurmse = {'CAT_prices': {'LAKE_prices': 5116.4002999897875, 'SUN_prices': 3193.5240850311479, 'WWD_prices': 2525.5805858736726, 'UTX_prices': 318.55976861691943, 'MCD_prices': 551.97614123774508, 'MSFT_prices': 2667.0261458652471, 'ORCL_prices': 3063.6851709303514, 'T_prices': 2894.4418747446894}, 'APA_prices': {'LAKE_prices': 5607.8008169934637, 'SUN_prices': 3427.9945291756026, 'WWD_prices': 3007.5529480778314, 'T_prices': 3158.4521912817863, 'UTX_prices': 1204.553897473703, 'MCD_prices': 1725.3513671875, 'MSFT_prices': 3197.817041334763, 'ORCL_prices': 3468.8255805121526, 'B_prices': 3791.9630999646156, 'CAT_prices': 746.15136982038905}, 'SUN_prices': {'UTX_prices': nan, 'T_prices': nan, 'WWD_prices': nan}, 'ABT_prices': {'LAKE_prices': 461.36146297080842, 'APA_prices': 2850.6169058506784, 'SUN_prices': 423.09022159950405, 'WWD_prices': 72.359710174760011, 'AEM_prices': 558.10254485529231, 'T_prices': 126.70672079348097, 'UTX_prices': 1630.8535325393177, 'AFG_prices': 220.47717420291278, 'MSFT_prices': 53.064635057387008, 'ORCL_prices': 42.465017450868693, 'MCD_prices': 1011.1407709258834, 'B_prices': 35.265018722434448, 'CAT_prices': 1788.9123723447713}, 'LAKE_prices': {'SUN_prices': 220.49506073496701, 'WWD_prices': 494.70636002285028, 'UTX_prices': 252.42694449829901, 'MCD_prices': 113.92212438645706, 'MSFT_prices': 17.04389018139808, 'ORCL_prices': 29.557670003604265, 'T_prices': 19.756843773835623}, 'UTX_prices': {'WWD_prices': 2546.3453728170957}, 'AEM_prices': {'LAKE_prices': 1389.2522315330755, 'APA_prices': 1482.7180318595538, 'SUN_prices': 973.660341709112, 'AFG_prices': 801.90406139099525, 'WWD_prices': 543.90495952531398, 'T_prices': 702.97990451388887, 'UTX_prices': 1191.3352430954478, 'MCD_prices': 1237.0759835037532, 'MSFT_prices': 720.68044677435182, 'ORCL_prices': 760.24796119640075, 'B_prices': 692.93603533576515, 'CAT_prices': 1205.9484406913807}, 'T_prices': {'UTX_prices': 2453.9917247497956, 'WWD_prices': 56.936422839195899}, 'AAPL_prices': {'LAKE_prices': 4275.8886894674861, 'APA_prices': 2645.0493993821487, 'SUN_prices': 3200.8212526807597, 'ABT_prices': 2393.7143112681269, 'WWD_prices': 1737.7865433038451, 'AEM_prices': 2580.6509985032426, 'T_prices': 2779.3349082797181, 'UTX_prices': 832.47099226409318, 'AFG_prices': 1256.9459419200623, 'MSFT_prices': 2259.9002908145681, 'ORCL_prices': 2424.9728753482595, 'MCD_prices': 589.17965032041468, 'B_prices': 2570.5974798464308, 'CAT_prices': 1214.1311202703737}, 'AFG_prices': {'LAKE_prices': 1514.6800018510007, 'APA_prices': 2293.4092497383067, 'SUN_prices': 859.7374912635953, 'WWD_prices': 198.58218817617379, 'T_prices': 641.89323742436432, 'UTX_prices': 1085.5703228470547, 'MCD_prices': 839.51918663074764, 'MSFT_prices': 274.91245936973422, 'ORCL_prices': 524.91341217639399, 'B_prices': 485.10170720916949, 'CAT_prices': 995.72807226243367}, 'MSFT_prices': {'ORCL_prices': 147.95954749412786, 'UTX_prices': 1357.6141032698886, 'WWD_prices': 47.639562270220587, 'SUN_prices': 385.34241672092014, 'T_prices': 215.88616944356681}, 'ORCL_prices': {'UTX_prices': 1575.5050969541462, 'WWD_prices': 46.814996193281189, 'SUN_prices': 458.22417219074725, 'T_prices': 109.1659735586129}, 'MCD_prices': {'SUN_prices': 3739.5831834980086, 'WWD_prices': 2222.2145086550245, 'UTX_prices': 285.62214224821599, 'MSFT_prices': 2505.9148499731923, 'ORCL_prices': 2814.0486660028596, 'T_prices': 3181.2245816099876}, 'IXIC_prices': {'LAKE_prices': 11938760.899346406, 'APA_prices': 11541280.067973856, 'SUN_prices': 11807123.749019608, 'ABT_prices': 11803493.756862745, 'UTX_prices': 11483071.639215685, 'WWD_prices': 11764916.250980392, 'AEM_prices': 11766760.292810457, 'T_prices': 11794361.71503268, 'AAPL_prices': 11590578.107189542, 'AFG_prices': 11701306.316339869, 'MSFT_prices': 11780483.675816994, 'ORCL_prices': 11821709.040522875, 'MCD_prices': 11500824.094117647, 'CAT_prices': 11542078.933333334, 'B_prices': 11820684.747712418}, 'B_prices': {'LAKE_prices': 438.98365709890726, 'SUN_prices': 337.19664007448682, 'WWD_prices': 62.411694994159774, 'T_prices': 146.14463219736137, 'UTX_prices': 589.5668901829938, 'MCD_prices': 832.63801828022872, 'MSFT_prices': 60.247726936589657, 'ORCL_prices': 103.18229946560329, 'CAT_prices': 1029.0222068238102}}

#qmemodelrmae = {'CAT_prices': {'LAKE_prices': 4.2566696687461505, 'SUN_prices': 4.2557623392616222, 'WWD_prices': 4.2145508563596437, 'UTX_prices': 4.2566696687461505, 'MCD_prices': 4.2566696687461505, 'MSFT_prices': 4.2562751863517017, 'ORCL_prices': 4.2566352252087558, 'T_prices': 4.2564017274021326}, 'APA_prices': {'LAKE_prices': 4.1853736653047449, 'SUN_prices': 4.1905176655139798, 'WWD_prices': 4.1853736653047449, 'T_prices': 4.1853736653047449, 'UTX_prices': 4.185407163582596, 'MCD_prices': 4.25062067960602, 'MSFT_prices': 4.1875175535289291, 'ORCL_prices': 4.1878964763840818, 'B_prices': 4.185329328175464, 'CAT_prices': 4.1853622492621927}, 'SUN_prices': {'UTX_prices': 2.6841286841560814, 'T_prices': 2.7383751872318243, 'WWD_prices': 2.6841615444694469}, 'ABT_prices': {'LAKE_prices': 1.7018480491014867, 'APA_prices': 1.6744541426889257, 'SUN_prices': 1.6740106077755199, 'WWD_prices': 1.6739784091126686, 'AEM_prices': 1.6739784091126686, 'T_prices': 1.6696239767510908, 'UTX_prices': 1.671882821687686, 'AFG_prices': 1.674001312879176, 'MSFT_prices': 1.6729189162160836, 'ORCL_prices': 1.7014086218441233, 'MCD_prices': 1.7000154161764904, 'B_prices': 1.7013961601880641, 'CAT_prices': 1.9384596709332436}, 'LAKE_prices': {'SUN_prices': 1.2482000460032545, 'WWD_prices': 1.1166532125348358, 'UTX_prices': 1.1166532125348358, 'MCD_prices': 1.1166544329886343, 'MSFT_prices': 1.1166458428295609, 'ORCL_prices': 1.2926213462368337, 'T_prices': 1.1166426120240704}, 'UTX_prices': {'WWD_prices': 3.4095963228761761}, 'AEM_prices': {'LAKE_prices': 3.8954138400507907, 'APA_prices': 3.8180946998346865, 'SUN_prices': 3.4190167274350434, 'AFG_prices': 3.8897219963323058, 'WWD_prices': 4.0056803940168395, 'T_prices': 3.8885253351498275, 'UTX_prices': 3.8896357218424478, 'MCD_prices': 3.8883705706378215, 'MSFT_prices': 3.4169957257563772, 'ORCL_prices': 3.8891064868253822, 'B_prices': 3.9417627203698253, 'CAT_prices': 3.8925980337305006}, 'T_prices': {'UTX_prices': 4.6716654659096708, 'WWD_prices': 4.6702952621809022}, 'AAPL_prices': {'LAKE_prices': 8.1343203762777492, 'APA_prices': 8.2064008588105253, 'SUN_prices': 7.9284266104106029, 'ABT_prices': 8.9805675955379716, 'WWD_prices': 8.1349283392912426, 'AEM_prices': 8.1352228114807534, 'T_prices': 8.1348462485020452, 'UTX_prices': 8.4940115872551409, 'AFG_prices': 8.1348462485020452, 'MSFT_prices': 8.1528826208675618, 'ORCL_prices': 8.1349813299241411, 'MCD_prices': 8.3752087437249472, 'B_prices': 8.1674688663358008, 'CAT_prices': 8.1345289915994883}, 'AFG_prices': {'LAKE_prices': 3.4151256205988867, 'APA_prices': 3.4416834575678008, 'SUN_prices': 3.3903114636739096, 'WWD_prices': 3.4151256205988867, 'T_prices': 3.4460289699579376, 'UTX_prices': 3.4152337921990288, 'MCD_prices': 3.4452554665359796, 'MSFT_prices': 3.5914211584851632, 'ORCL_prices': 3.445143492081586, 'B_prices': 3.4118038264754551, 'CAT_prices': 3.7162851988100538}, 'MSFT_prices': {'ORCL_prices': 2.2741164459901699, 'UTX_prices': 2.2741901257458856, 'WWD_prices': 1.1850499187419616, 'SUN_prices': 2.2742389139786265, 'T_prices': 2.2722130114736121}, 'ORCL_prices': {'UTX_prices': 2.7805470373116288, 'WWD_prices': 3.1375013382606256, 'SUN_prices': 3.1413768120061336, 'T_prices': 3.1414151185478261}, 'MCD_prices': {'SUN_prices': 9.3063058067770559, 'WWD_prices': 9.1713753195369954, 'UTX_prices': 9.2857652202930332, 'MSFT_prices': 9.1713753195369954, 'ORCL_prices': 9.170951222438438, 'T_prices': 9.1713753195369954}, 'IXIC_prices': {'LAKE_prices': 320.49322094886134, 'APA_prices': 228.40564339830985, 'SUN_prices': 297.09382775001279, 'ABT_prices': 273.29916154450063, 'UTX_prices': 273.31165939031865, 'WWD_prices': 267.32446859521804, 'AEM_prices': 271.29129941853046, 'T_prices': 273.31735564587166, 'AAPL_prices': 594.82147583805659, 'AFG_prices': 273.31582402248006, 'MSFT_prices': 272.90885057636336, 'ORCL_prices': 273.36254763135724, 'MCD_prices': 273.31582402248006, 'CAT_prices': 229.16588134765624, 'B_prices': 273.31582402248006}, 'B_prices': {'LAKE_prices': 2.7636022087795284, 'SUN_prices': 2.7636032384984635, 'WWD_prices': 2.7636022087795284, 'T_prices': 2.7636022087795284, 'UTX_prices': 2.8133637129091751, 'MCD_prices': 2.7636022087795284, 'MSFT_prices': 2.6593093161489447, 'ORCL_prices': 2.7634703723433751, 'CAT_prices': 2.5478143804213582}}
#qmemodelurmae = {'CAT_prices': {'LAKE_prices': 1.0644256339353673, 'SUN_prices': 4.2708524616715176, 'WWD_prices': 5.7242702758390136, 'UTX_prices': 8.7985202477648361, 'MCD_prices': 4.8777465059866314, 'MSFT_prices': 7.7287315842372921, 'ORCL_prices': 5.1748416009292102, 'T_prices': 3.4283624508801629}, 'APA_prices': {'LAKE_prices': 1.0636050035750944, 'SUN_prices': 4.3099161762038092, 'WWD_prices': 5.7185343225017871, 'T_prices': 3.2951018215004915, 'UTX_prices': 8.9699179057202301, 'MCD_prices': 4.8777686424504694, 'MSFT_prices': 7.3536078758489074, 'ORCL_prices': 5.1772289961771252, 'B_prices': 3.2702256607853508, 'CAT_prices': 16.529524470310584}, 'SUN_prices': {'UTX_prices': 8.8438760695114631, 'T_prices': 3.3320688104317857, 'WWD_prices': 5.7185343225017871}, 'ABT_prices': {'LAKE_prices': 1.0644256339353673, 'APA_prices': 16.541248175677133, 'SUN_prices': 4.2708686756931877, 'WWD_prices': 5.7185343225017871, 'AEM_prices': 4.4424695575938502, 'T_prices': 3.2946835748510424, 'UTX_prices': 9.0403152204027357, 'AFG_prices': 6.8359859678480364, 'MSFT_prices': 7.3349336910871124, 'ORCL_prices': 5.2550952930076447, 'MCD_prices': 4.8777275023117568, 'B_prices': 3.3013527514887793, 'CAT_prices': 16.509230689753114}, 'LAKE_prices': {'SUN_prices': 4.2709129031187567, 'WWD_prices': 5.7241298912397394, 'UTX_prices': 8.7566224453495991, 'MCD_prices': 4.8777686424504694, 'MSFT_prices': 7.3555201100368128, 'ORCL_prices': 5.1748091660293882, 'T_prices': 3.4270134218378003}, 'UTX_prices': {'WWD_prices': 5.7186495163861446}, 'AEM_prices': {'LAKE_prices': 1.0644256339353673, 'APA_prices': 16.541742053063086, 'SUN_prices': 4.3009204970465769, 'AFG_prices': 6.2977281782362198, 'WWD_prices': 5.7185343225017871, 'T_prices': 3.2951491901297976, 'UTX_prices': 8.9571991477916448, 'MCD_prices': 4.8779062221252838, 'MSFT_prices': 7.3375529519872726, 'ORCL_prices': 5.1955779100555217, 'B_prices': 3.3614982424218671, 'CAT_prices': 16.511307415931054}, 'T_prices': {'UTX_prices': 8.8012438381419464, 'WWD_prices': 5.8413633034899348}, 'AAPL_prices': {'LAKE_prices': 1.064419234656041, 'APA_prices': 16.539778895159952, 'SUN_prices': 4.2707659001443901, 'ABT_prices': 2.7345823637021134, 'WWD_prices': 5.7239250681758707, 'AEM_prices': 4.4326436952827803, 'T_prices': 3.4283749087963229, 'UTX_prices': 8.957468944125706, 'AFG_prices': 6.2610416798809778, 'MSFT_prices': 7.3372840195699451, 'ORCL_prices': 5.5697048935235713, 'MCD_prices': 4.9043217066845859, 'B_prices': 3.30195527107887, 'CAT_prices': 16.509920952990164}, 'AFG_prices': {'LAKE_prices': 1.0644108518276338, 'APA_prices': 16.540267776040469, 'SUN_prices': 4.2708436591952452, 'WWD_prices': 5.7185208264519183, 'T_prices': 3.4284787009744084, 'UTX_prices': 8.9489789115058045, 'MCD_prices': 4.8778105654747659, 'MSFT_prices': 7.6333151112974083, 'ORCL_prices': 5.1748091660293882, 'B_prices': 3.3013527514887793, 'CAT_prices': 16.509230689753114}, 'MSFT_prices': {'ORCL_prices': 5.1748792716880248, 'UTX_prices': 8.9573794645421643, 'WWD_prices': 5.4342970399295583, 'SUN_prices': 4.2710737979489997, 'T_prices': 3.6179591677547278}, 'ORCL_prices': {'UTX_prices': 8.9573429755915228, 'WWD_prices': 5.7059612436232223, 'SUN_prices': 4.2708436591952452, 'T_prices': 3.4283415058859035}, 'MCD_prices': {'SUN_prices': 4.2708436591952452, 'WWD_prices': 5.7185343225017871, 'UTX_prices': 8.9588186338836078, 'MSFT_prices': 7.3372840195699451, 'ORCL_prices': 5.1748114305384023, 'T_prices': 3.4283624508801629}, 'IXIC_prices': {'LAKE_prices': 1.0644256339353673, 'APA_prices': 16.967638021980235, 'SUN_prices': 4.2708436591952452, 'ABT_prices': 2.7412417455436358, 'UTX_prices': 8.9573826447031859, 'WWD_prices': 5.7185343225017871, 'AEM_prices': 4.4454735631257103, 'T_prices': 3.4282601951773648, 'AAPL_prices': 21.531509818282782, 'AFG_prices': 6.2653353959127189, 'MSFT_prices': 7.7535094990449789, 'ORCL_prices': 5.1744625091552736, 'MCD_prices': 4.8767855326334635, 'CAT_prices': 16.509230689753114, 'B_prices': 3.3012964778476293}, 'B_prices': {'LAKE_prices': 1.0999434065974616, 'SUN_prices': 4.2708436591952452, 'WWD_prices': 5.9653806486940075, 'T_prices': 3.4283848921457927, 'UTX_prices': 8.914615051419128, 'MCD_prices': 4.8777481502956812, 'MSFT_prices': 7.337289806440765, 'ORCL_prices': 5.174917038437588, 'CAT_prices': 16.509214017282126}}
#qmemodelrmse = {'CAT_prices': {'LAKE_prices': 16.084745509328407, 'SUN_prices': 16.081375954821219, 'WWD_prices': 15.930503857681174, 'UTX_prices': 16.084745509328407, 'MCD_prices': 16.084745509328407, 'MSFT_prices': 16.083312912236632, 'ORCL_prices': 16.084602110370312, 'T_prices': 16.083769122603673}, 'APA_prices': {'LAKE_prices': 16.072292512382557, 'SUN_prices': 16.09487562989877, 'WWD_prices': 16.072292512382557, 'T_prices': 16.072292512382557, 'UTX_prices': 16.072437957065556, 'MCD_prices': 16.342200552248489, 'MSFT_prices': 16.081788015677258, 'ORCL_prices': 16.083325778736789, 'B_prices': 16.072102737426757, 'CAT_prices': 16.072242886412379}, 'SUN_prices': {'UTX_prices': nan, 'T_prices': nan, 'WWD_prices': nan}, 'ABT_prices': {'LAKE_prices': 6.1378694197710821, 'APA_prices': 6.0458589553833004, 'SUN_prices': 6.0443918465009698, 'WWD_prices': 6.0442848118302086, 'AEM_prices': 6.0442848118302086, 'T_prices': 6.0298677843380597, 'UTX_prices': 6.0372898463330236, 'AFG_prices': 6.0443590176650899, 'MSFT_prices': 6.0407594655853467, 'ORCL_prices': 6.1364075268016141, 'MCD_prices': 6.1317495794857253, 'B_prices': 6.1363654953202387, 'CAT_prices': 6.9240619185703256}, 'LAKE_prices': {'SUN_prices': nan, 'WWD_prices': nan, 'UTX_prices': nan, 'MCD_prices': nan, 'MSFT_prices': nan, 'ORCL_prices': nan, 'T_prices': nan}, 'UTX_prices': {'WWD_prices': 12.976559638977051}, 'AEM_prices': {'LAKE_prices': 14.246658297769384, 'APA_prices': 13.999493298499413, 'SUN_prices': 12.732630819432876, 'AFG_prices': 14.228688111648061, 'WWD_prices': 14.595345874861176, 'T_prices': 14.2249897801019, 'UTX_prices': 14.228555267932368, 'MCD_prices': 14.224516114378288, 'MSFT_prices': 12.723738595551135, 'ORCL_prices': 14.226825317682005, 'B_prices': 14.392365586523916, 'CAT_prices': 14.237316049314012}, 'T_prices': {'UTX_prices': 15.040901725120793, 'WWD_prices': 15.03667206608392}, 'AAPL_prices': {'LAKE_prices': 27.855305131899765, 'APA_prices': 28.078370561786727, 'SUN_prices': 27.226699475057764, 'ABT_prices': 30.427409956190321, 'WWD_prices': 27.857149440790312, 'AEM_prices': 27.858039531832429, 'T_prices': 27.856897710663041, 'UTX_prices': 28.951362260806015, 'AFG_prices': 27.856897710663041, 'MSFT_prices': 27.927510325113932, 'ORCL_prices': 27.857305489334404, 'MCD_prices': 28.587752094144136, 'B_prices': 27.967145677952985, 'CAT_prices': 27.855929161520564}, 'AFG_prices': {'LAKE_prices': 11.473329145144794, 'APA_prices': 11.554453833586249, 'SUN_prices': 11.39691575991562, 'WWD_prices': 11.473329145144794, 'T_prices': 11.567120505937563, 'UTX_prices': 11.473667748145807, 'MCD_prices': 11.564851528990502, 'MSFT_prices': 12.010457214654661, 'ORCL_prices': 11.564517042371962, 'B_prices': 11.46267818874783, 'CAT_prices': 12.394704958348493}, 'MSFT_prices': {'ORCL_prices': 8.2016114266090145, 'UTX_prices': 8.2018356946558733, 'WWD_prices': 4.6667975260541326, 'SUN_prices': 8.2019834680494927, 'T_prices': 8.195756613039503}, 'ORCL_prices': {'UTX_prices': 9.3539567062278195, 'WWD_prices': 10.449724809484545, 'SUN_prices': 10.460510703940797, 'T_prices': 10.460627610699024}, 'MCD_prices': {'SUN_prices': 30.640575398962483, 'WWD_prices': 30.23558486240362, 'UTX_prices': 30.584599787892859, 'MSFT_prices': 30.23558486240362, 'ORCL_prices': 30.234301453634025, 'T_prices': 30.23558486240362}, 'IXIC_prices': {'LAKE_prices': 1053.7349267897264, 'APA_prices': 767.19411046645223, 'SUN_prices': 981.06189379723241, 'ABT_prices': 906.81826522926883, 'UTX_prices': 906.8572425194036, 'WWD_prices': 888.1233152701185, 'AEM_prices': 900.54570567810458, 'T_prices': 906.87519515293093, 'AAPL_prices': 1906.1022448171977, 'AFG_prices': 906.87033436095794, 'MSFT_prices': 905.5992755565768, 'ORCL_prices': 907.01619785283901, 'MCD_prices': 906.87033436095794, 'CAT_prices': 769.15787074269815, 'B_prices': 906.87033436095794}, 'B_prices': {'LAKE_prices': 9.5614003399618319, 'SUN_prices': 9.5613894319222652, 'WWD_prices': 9.5614003399618319, 'T_prices': 9.5614003399618319, 'UTX_prices': 9.7127178017610039, 'MCD_prices': 9.5614003399618319, 'MSFT_prices': 9.2455800573810247, 'ORCL_prices': 9.5609885695713022, 'CAT_prices': 8.9078498428943114}}
#qmemodelurmse = {'CAT_prices': {'LAKE_prices': nan, 'SUN_prices': nan, 'WWD_prices': 18.933394231359944, 'UTX_prices': 29.769797426111559, 'MCD_prices': 17.39275322209776, 'MSFT_prices': 24.894433693480646, 'ORCL_prices': 16.775710393868241, 'T_prices': 11.29702768263474}, 'APA_prices': {'LAKE_prices': nan, 'SUN_prices': nan, 'WWD_prices': 18.915911969951555, 'T_prices': 10.893885921652799, 'UTX_prices': 30.304025014241535, 'MCD_prices': 17.392825367248136, 'MSFT_prices': 23.731168599845539, 'ORCL_prices': 16.783117032518575, 'B_prices': 11.147210351781908, 'CAT_prices': 53.733179389105899}, 'SUN_prices': {'UTX_prices': 29.912225636002287, 'T_prices': 11.006088241876339, 'WWD_prices': 18.915911969951555}, 'ABT_prices': {'LAKE_prices': nan, 'APA_prices': 54.356586790396499, 'SUN_prices': nan, 'WWD_prices': 18.915911969951555, 'AEM_prices': 15.98466941983092, 'T_prices': 10.892642588397257, 'UTX_prices': 30.52313053904016, 'AFG_prices': 22.020024906731898, 'MSFT_prices': 23.673321433472477, 'ORCL_prices': 17.025344342499778, 'MCD_prices': 17.392709215949562, 'B_prices': 11.242148024116466, 'CAT_prices': 53.670357473535475}, 'LAKE_prices': {'SUN_prices': nan, 'WWD_prices': 18.932986966301414, 'UTX_prices': 29.638925634645947, 'MCD_prices': 17.392825367248136, 'MSFT_prices': 23.737063434077243, 'ORCL_prices': 16.775609249538846, 'T_prices': 11.292999774957794}, 'UTX_prices': {'WWD_prices': 18.916270601359848}, 'AEM_prices': {'LAKE_prices': nan, 'APA_prices': 54.358146333382798, 'SUN_prices': nan, 'AFG_prices': 20.350191368152892, 'WWD_prices': 18.915911969951555, 'T_prices': 10.89404252120872, 'UTX_prices': 30.264360051373252, 'MCD_prices': 17.393313758201849, 'MSFT_prices': 23.681385374380874, 'ORCL_prices': 16.842306767881308, 'B_prices': 11.425273957595326, 'CAT_prices': 53.676721620248031}, 'T_prices': {'UTX_prices': 29.781232078402649, 'WWD_prices': 19.285348074420604}, 'AAPL_prices': {'LAKE_prices': nan, 'APA_prices': 54.352108769634967, 'SUN_prices': nan, 'ABT_prices': 9.4734431684406761, 'WWD_prices': 18.932396553388607, 'AEM_prices': 15.954727888418958, 'T_prices': 11.297062163259469, 'UTX_prices': 30.265198262532554, 'AFG_prices': 20.236709036234938, 'MSFT_prices': 23.680554498410693, 'ORCL_prices': 18.004436999052956, 'MCD_prices': 17.475221661337059, 'B_prices': 11.243992330513748, 'CAT_prices': 53.672476864484402}, 'AFG_prices': {'LAKE_prices': nan, 'APA_prices': 54.35360884822272, 'SUN_prices': nan, 'WWD_prices': 18.915866093853719, 'T_prices': 11.297374207989064, 'UTX_prices': 30.239567166995378, 'MCD_prices': 17.392963713602303, 'MSFT_prices': 24.599378653133616, 'ORCL_prices': 16.775609249538846, 'B_prices': 11.242148024116466, 'CAT_prices': 53.670357473535475}, 'MSFT_prices': {'ORCL_prices': 16.775827594831878, 'UTX_prices': 30.264923888561771, 'WWD_prices': 18.040557350208555, 'SUN_prices': nan, 'T_prices': 11.870024712257136}, 'ORCL_prices': {'UTX_prices': 30.264805563135084, 'WWD_prices': 18.877724264805614, 'SUN_prices': nan, 'T_prices': 11.296964803708144}, 'MCD_prices': {'SUN_prices': nan, 'WWD_prices': 18.915911969951555, 'UTX_prices': 30.269501425549876, 'MSFT_prices': 23.680554498410693, 'ORCL_prices': 16.775617277855968, 'T_prices': 11.29702768263474}, 'IXIC_prices': {'LAKE_prices': nan, 'APA_prices': 55.649138506721044, 'SUN_prices': nan, 'ABT_prices': 9.4929508707881745, 'UTX_prices': 30.264936609205858, 'WWD_prices': 18.915911969951555, 'AEM_prices': 15.994001199061575, 'T_prices': 11.296731931399675, 'AAPL_prices': 69.022513335982183, 'AFG_prices': 20.249967826893126, 'MSFT_prices': 24.971157557668249, 'ORCL_prices': 16.774538675944012, 'MCD_prices': 17.389578581167981, 'CAT_prices': 53.670357473535475, 'B_prices': 11.241974612466651}, 'B_prices': {'LAKE_prices': nan, 'SUN_prices': nan, 'WWD_prices': 19.670457408630771, 'T_prices': 11.297091417998271, 'UTX_prices': 30.132937502393535, 'MCD_prices': 17.392759629791858, 'MSFT_prices': 23.680574274998087, 'ORCL_prices': 16.775946319181156, 'CAT_prices': 53.670312470080809}}

#msemodelrmae = {'CAT_prices': {'LAKE_prices': 10.845609603831971, 'SUN_prices': 10.635562198613984, 'WWD_prices': 10.590651196747823, 'UTX_prices': 10.791090673558852, 'MCD_prices': 10.932318734811023, 'MSFT_prices': 11.340031833274692, 'ORCL_prices': 10.479127744288226, 'T_prices': 10.546867343179541}, 'APA_prices': {'LAKE_prices': 3.7572988909054428, 'SUN_prices': 3.7794828645544114, 'WWD_prices': 3.7747193797741061, 'T_prices': 3.7809759286494038, 'UTX_prices': 3.7475765203338822, 'MCD_prices': 3.7588209170921174, 'MSFT_prices': 3.8013280167299159, 'ORCL_prices': 3.6877187264511009, 'B_prices': 3.8976750127630297, 'CAT_prices': 3.8089035118327423}, 'SUN_prices': {'UTX_prices': 3.3403342702030359, 'T_prices': 3.5393012458202886, 'WWD_prices': 3.7263491237864774}, 'ABT_prices': {'LAKE_prices': 4.0925000639522775, 'APA_prices': 4.0395156910216885, 'SUN_prices': 3.5901419676986395, 'WWD_prices': 3.7526766608743105, 'AEM_prices': 4.1421071457707024, 'T_prices': 4.0683171602635602, 'UTX_prices': 3.9902839074726977, 'AFG_prices': 3.7069866211585749, 'MSFT_prices': 4.1376447521783168, 'ORCL_prices': 4.0377965721429563, 'MCD_prices': 4.0636150796429007, 'B_prices': 4.1322608885422252, 'CAT_prices': 4.1240262112586326}, 'LAKE_prices': {'SUN_prices': 1.1547088800692091, 'WWD_prices': 1.051167381511015, 'UTX_prices': 1.1512869043287888, 'MCD_prices': 1.1665225158329882, 'MSFT_prices': 1.1401382025550393, 'ORCL_prices': 1.1389675955367244, 'T_prices': 1.1169208440905303}, 'UTX_prices': {'WWD_prices': 6.5728397219788794}, 'AEM_prices': {'LAKE_prices': 2.4104536513097927, 'APA_prices': 2.3437067740882922, 'SUN_prices': 2.4855393230525498, 'AFG_prices': 2.3436551296633055, 'WWD_prices': 2.4114241743399427, 'T_prices': 2.4025711516149681, 'UTX_prices': 2.4000001204559225, 'MCD_prices': 2.4211783195632735, 'MSFT_prices': 2.407548330500235, 'ORCL_prices': 2.4275395070805268, 'B_prices': 2.3898764904807597, 'CAT_prices': 2.3747570807637732}, 'T_prices': {'UTX_prices': 4.5699026943032255, 'WWD_prices': 4.5295011414421928}, 'AAPL_prices': {'LAKE_prices': 3.8239748898674462, 'APA_prices': 4.8177210546007343, 'SUN_prices': 3.327179861380384, 'ABT_prices': 3.7369367032269247, 'WWD_prices': 3.3596905979455687, 'AEM_prices': 4.5302692918216483, 'T_prices': 3.6709399871576847, 'UTX_prices': 4.340016682942708, 'AFG_prices': 3.9145455079920151, 'MSFT_prices': 3.4710812587364046, 'ORCL_prices': 4.5456797194636724, 'MCD_prices': 3.9793532383987329, 'B_prices': 3.8971739500955818, 'CAT_prices': 3.9445483132904653}, 'AFG_prices': {'LAKE_prices': 8.4277194016899166, 'APA_prices': 8.6547895244523598, 'SUN_prices': 8.3359957788504815, 'WWD_prices': 8.4627089394463439, 'T_prices': 7.9927191553552168, 'UTX_prices': 8.313159146028406, 'MCD_prices': 8.3471101224812028, 'MSFT_prices': 8.4055101456984982, 'ORCL_prices': 8.1948598986357641, 'B_prices': 8.6532935335745211, 'CAT_prices': 8.351363827823814}, 'MSFT_prices': {'ORCL_prices': 6.2621119754766328, 'UTX_prices': 6.7450295130411781, 'WWD_prices': 6.2587429059097186, 'SUN_prices': 6.2990550059898229, 'T_prices': 6.3240518532547298}, 'ORCL_prices': {'UTX_prices': 1.0998732778761122, 'WWD_prices': 1.25980932338565, 'SUN_prices': 0.9617908392077178, 'T_prices': 1.0012252327663447}, 'MCD_prices': {'SUN_prices': 9.2147436952279289, 'WWD_prices': 9.2504293977824688, 'UTX_prices': 7.8269486620535256, 'MSFT_prices': 9.185240165860046, 'ORCL_prices': 8.9665731093462782, 'T_prices': 9.2777556101481125}, 'IXIC_prices': {'LAKE_prices': 507.57939724392361, 'APA_prices': 539.95557789522059, 'SUN_prices': 512.71841243170445, 'ABT_prices': 504.41043916590075, 'UTX_prices': 504.36837836371529, 'WWD_prices': 510.16831214256536, 'AEM_prices': 540.641395000383, 'T_prices': 505.02189893535541, 'AAPL_prices': 98.824796649209816, 'AFG_prices': 502.35200801674836, 'MSFT_prices': 501.17048587175753, 'ORCL_prices': 497.25468630323223, 'MCD_prices': 504.53590989455677, 'CAT_prices': 508.79543959673714, 'B_prices': 502.67039651309744}, 'B_prices': {'LAKE_prices': 3.2333756309708739, 'SUN_prices': 3.7109458231458476, 'WWD_prices': 3.0107425870459066, 'T_prices': 3.2387989916832618, 'UTX_prices': 3.223725265926785, 'MCD_prices': 3.3841955914216881, 'MSFT_prices': 3.4513225860845029, 'ORCL_prices': 4.2931481143228369, 'CAT_prices': 4.2635027156156653}}
#msemodelurmae = {'CAT_prices': {'LAKE_prices': 66.117296695085912, 'SUN_prices': 44.988615028530944, 'WWD_prices': 43.685056494419868, 'UTX_prices': 12.000109910653308, 'MCD_prices': 18.012289837606591, 'MSFT_prices': 46.174742310966543, 'ORCL_prices': 50.782500372992622, 'T_prices': 48.601998312956368}, 'APA_prices': {'LAKE_prices': 70.692382019641357, 'SUN_prices': 50.030665214388975, 'WWD_prices': 49.558594682481555, 'T_prices': 53.72439408146478, 'UTX_prices': 28.912362650952307, 'MCD_prices': 33.252196796890956, 'MSFT_prices': 51.68168563967437, 'ORCL_prices': 55.312019871730428, 'B_prices': 56.118431061389401, 'CAT_prices': 21.984322800979115}, 'SUN_prices': {'UTX_prices': 33.732104661729601, 'T_prices': 19.119926800447352, 'WWD_prices': 19.325035179985893}, 'ABT_prices': {'LAKE_prices': 18.906516899158753, 'APA_prices': 41.697575514300979, 'SUN_prices': 14.590526605743209, 'WWD_prices': 4.8775761785070877, 'AEM_prices': 15.782873714048099, 'T_prices': 8.7850289363487093, 'UTX_prices': 39.800618963303911, 'AFG_prices': 8.5326299181171485, 'MSFT_prices': 5.0097119773914613, 'ORCL_prices': 5.9653945972716889, 'MCD_prices': 30.949443109051074, 'B_prices': 6.1863212138219597, 'CAT_prices': 36.862966205871182}, 'LAKE_prices': {'SUN_prices': 11.427175809199515, 'WWD_prices': 21.124082473056767, 'UTX_prices': 3.3036113957174464, 'MCD_prices': 3.264694402732101, 'MSFT_prices': 3.3702108414344538, 'ORCL_prices': 3.7121670564015705, 'T_prices': 3.2917957424338349}, 'UTX_prices': {'WWD_prices': 46.764955802368959}, 'AEM_prices': {'LAKE_prices': 33.196917829326551, 'APA_prices': 32.592193315543383, 'SUN_prices': 24.934487658232644, 'AFG_prices': 23.165797813265932, 'WWD_prices': 18.889548340342404, 'T_prices': 22.752031987009484, 'UTX_prices': 25.204702150432112, 'MCD_prices': 24.321364184610204, 'MSFT_prices': 20.867857670939827, 'ORCL_prices': 20.392437300962559, 'B_prices': 20.484699072245679, 'CAT_prices': 29.302788319307215}, 'T_prices': {'UTX_prices': 50.300381489672695, 'WWD_prices': 8.1506098628823267}, 'AAPL_prices': {'LAKE_prices': 49.968874523686431, 'APA_prices': 47.469444823420908, 'SUN_prices': 48.104659445768867, 'ABT_prices': 35.516554599338107, 'WWD_prices': 29.273529102599699, 'AEM_prices': 40.596736573861314, 'T_prices': 40.333717037026396, 'UTX_prices': 26.192624798943015, 'AFG_prices': 25.79424536212597, 'MSFT_prices': 35.360450664844386, 'ORCL_prices': 33.710053098591324, 'MCD_prices': 20.28658736235176, 'B_prices': 36.896842512741586, 'CAT_prices': 30.896044393302567}, 'AFG_prices': {'LAKE_prices': 32.464341865489686, 'APA_prices': 39.826049824633628, 'SUN_prices': 24.609058444951874, 'WWD_prices': 11.425271037980622, 'T_prices': 19.119620867959814, 'UTX_prices': 25.828418990677477, 'MCD_prices': 21.041150477041604, 'MSFT_prices': 15.267269558376736, 'ORCL_prices': 16.794683862823288, 'B_prices': 18.256435887953813, 'CAT_prices': 25.907318668739467}, 'MSFT_prices': {'ORCL_prices': 8.5710369184905399, 'UTX_prices': 43.295432500901562, 'WWD_prices': 5.0964511509814292, 'SUN_prices': 16.203101877449384, 'T_prices': 7.7884161357006993}, 'ORCL_prices': {'UTX_prices': 32.044946269116373, 'WWD_prices': 4.1815824845257925, 'SUN_prices': 16.531765687231925, 'T_prices': 10.309805734173144}, 'MCD_prices': {'SUN_prices': 52.318112751081877, 'WWD_prices': 44.975965472452003, 'UTX_prices': 14.057128123364418, 'MSFT_prices': 47.352918856751685, 'ORCL_prices': 50.803936338736342, 'T_prices': 49.67354870964499}, 'IXIC_prices': {'LAKE_prices': 3222.2046875000001, 'APA_prices': 3157.450617851307, 'SUN_prices': 3200.6865687551062, 'ABT_prices': 3203.360680274714, 'UTX_prices': 3158.8053672640931, 'WWD_prices': 3199.4517386642156, 'AEM_prices': 3191.266494970384, 'T_prices': 3202.3324671926061, 'AAPL_prices': 3178.7108640982433, 'AFG_prices': 3192.7398967269201, 'MSFT_prices': 3199.7235498366013, 'ORCL_prices': 3205.4237828073938, 'MCD_prices': 3161.7496757557192, 'CAT_prices': 3162.8918702767564, 'B_prices': 3207.0465513939953}, 'B_prices': {'LAKE_prices': 16.863208217246861, 'SUN_prices': 14.721123128155478, 'WWD_prices': 6.8283661019568349, 'T_prices': 9.626170608420777, 'UTX_prices': 25.176003180609808, 'MCD_prices': 18.635853097953049, 'MSFT_prices': 6.7326153699089497, 'ORCL_prices': 5.7490972007801329, 'CAT_prices': 31.593934401967168}}
#msemodelrmse = {'CAT_prices': {'LAKE_prices': 134.80765215306499, 'SUN_prices': 130.22117622724545, 'WWD_prices': 129.26963475046594, 'UTX_prices': 133.52982514823964, 'MCD_prices': 136.7185880374285, 'MSFT_prices': 145.89298490636489, 'ORCL_prices': 126.73111590217141, 'T_prices': 128.30612443911483}, 'APA_prices': {'LAKE_prices': 23.320987225202174, 'SUN_prices': 23.806201436161217, 'WWD_prices': 23.69358924042945, 'T_prices': 23.780581264869838, 'UTX_prices': 23.127620490080393, 'MCD_prices': 23.27980490790473, 'MSFT_prices': 24.190191541933547, 'ORCL_prices': 22.416413601395352, 'B_prices': 26.039790258220599, 'CAT_prices': 24.328341839360256}, 'SUN_prices': {'UTX_prices': 23.344749445697062, 'T_prices': 24.761623067170188, 'WWD_prices': 26.162867832807155}, 'ABT_prices': {'LAKE_prices': 19.517841448815041, 'APA_prices': 19.061962127685547, 'SUN_prices': 15.399874865463357, 'WWD_prices': 16.688523814880771, 'AEM_prices': 19.952700880462046, 'T_prices': 19.313414131114687, 'UTX_prices': 18.640934374441507, 'AFG_prices': 16.31756667093514, 'MSFT_prices': 19.911817827411728, 'ORCL_prices': 19.052554934632543, 'MCD_prices': 19.270683667550678, 'B_prices': 19.864131678163616, 'CAT_prices': 19.793348733739915}, 'LAKE_prices': {'SUN_prices': 2.6902063581678601, 'WWD_prices': 2.4237085382922801, 'UTX_prices': 2.6742499488631104, 'MCD_prices': 2.7158568949481241, 'MSFT_prices': 2.6516086553436478, 'ORCL_prices': 2.63601832670324, 'T_prices': 2.5775327183841878}, 'UTX_prices': {'WWD_prices': 53.890830225726361}, 'AEM_prices': {'LAKE_prices': 9.6409924058353198, 'APA_prices': 9.1696934924406168, 'SUN_prices': 10.42063051984201, 'AFG_prices': 9.1690994150498337, 'WWD_prices': 9.5566199090745716, 'T_prices': 9.4531339645385746, 'UTX_prices': 9.4829767383001986, 'MCD_prices': 9.7246917500215417, 'MSFT_prices': 9.4384668599546337, 'ORCL_prices': 9.6345690914228843, 'B_prices': 9.3642785427617099, 'CAT_prices': 9.1722539259717362}, 'T_prices': {'UTX_prices': 22.331657898348141, 'WWD_prices': 21.959342460382999}, 'AAPL_prices': {'LAKE_prices': 24.438310296551077, 'APA_prices': 36.673620435926651, 'SUN_prices': 19.035026941735762, 'ABT_prices': 23.461109211242277, 'WWD_prices': 19.380235011281531, 'AEM_prices': 33.021107079001034, 'T_prices': 22.74026056676129, 'UTX_prices': 30.603303423114852, 'AFG_prices': 25.465055373447392, 'MSFT_prices': 20.618036646624795, 'ORCL_prices': 33.226940165002361, 'MCD_prices': 26.220551155439388, 'B_prices': 25.275812981798758, 'CAT_prices': 25.847282955693263}, 'AFG_prices': {'LAKE_prices': 81.156641063814845, 'APA_prices': 85.424332183638427, 'SUN_prices': 79.507937741747085, 'WWD_prices': 81.831569217856412, 'T_prices': 73.3867980159186, 'UTX_prices': 79.120437063578692, 'MCD_prices': 79.695356022454561, 'MSFT_prices': 80.807783338758682, 'ORCL_prices': 76.916742521797133, 'B_prices': 85.395180576299524, 'CAT_prices': 79.790077319176362}, 'MSFT_prices': {'ORCL_prices': 45.800106632008273, 'UTX_prices': 52.661706463184231, 'WWD_prices': 45.756624109604779, 'SUN_prices': 46.297103592617063, 'T_prices': 46.645726461971506}, 'ORCL_prices': {'UTX_prices': 1.9279120644712759, 'WWD_prices': 2.3960279913509592, 'SUN_prices': 1.5910944714265711, 'T_prices': 1.6595467371099135}, 'MCD_prices': {'SUN_prices': 104.72241119185304, 'WWD_prices': 105.39961128982843, 'UTX_prices': 79.768916669858044, 'MSFT_prices': 104.15943392086652, 'ORCL_prices': 99.587192949282581, 'T_prices': 105.98993845422284}, 'IXIC_prices': {'LAKE_prices': 283919.37034313724, 'APA_prices': 319876.26388888888, 'SUN_prices': 289432.831372549, 'ABT_prices': 280535.46176470589, 'UTX_prices': 280469.09035947715, 'WWD_prices': 286678.08194444445, 'AEM_prices': 320674.46650326799, 'T_prices': 281156.8183006536, 'AAPL_prices': 14286.612237030229, 'AFG_prices': 278250.89714052289, 'MSFT_prices': 277066.14362745098, 'ORCL_prices': 272850.82426470588, 'MCD_prices': 280621.25555555557, 'CAT_prices': 285173.0461601307, 'B_prices': 278591.9306372549}, 'B_prices': {'LAKE_prices': 13.252962698344312, 'SUN_prices': 16.848842590930413, 'WWD_prices': 11.707842568790211, 'T_prices': 13.297944506476908, 'UTX_prices': 13.189466977586934, 'MCD_prices': 14.334931172888263, 'MSFT_prices': 14.835582573585262, 'ORCL_prices': 21.863049366271575, 'CAT_prices': 21.586893039279513}}
#msemodelurmse = {'CAT_prices': {'LAKE_prices': 4770.9025524662993, 'SUN_prices': 2810.2897111481311, 'WWD_prices': 2130.1349267897263, 'UTX_prices': 218.88900586296529, 'MCD_prices': 476.59224522409875, 'MSFT_prices': 2435.2973366332212, 'ORCL_prices': 2798.5639405892566, 'T_prices': 2661.2554534313726}, 'APA_prices': {'LAKE_prices': 5524.4926283892464, 'SUN_prices': 3487.254923502604, 'WWD_prices': 3128.5977146821865, 'T_prices': 3427.4109005198761, 'UTX_prices': 1103.5315132889093, 'MCD_prices': 1550.3040280809589, 'MSFT_prices': 3415.1763208626144, 'ORCL_prices': 3700.8878461650775, 'B_prices': 3842.6748955919852, 'CAT_prices': 753.10205445133784}, 'SUN_prices': {'UTX_prices': 1514.885897129034, 'T_prices': 539.85981674692994, 'WWD_prices': 631.24659048840886}, 'ABT_prices': {'LAKE_prices': 451.82457514744181, 'APA_prices': 2268.2828755995806, 'SUN_prices': 344.70191409042457, 'WWD_prices': 39.989301998163363, 'AEM_prices': 368.15729148964476, 'T_prices': 125.03591072980096, 'UTX_prices': 1696.4168284696691, 'AFG_prices': 154.19700177759907, 'MSFT_prices': 37.83574100569183, 'ORCL_prices': 42.335299363479116, 'MCD_prices': 1201.2503499348959, 'B_prices': 50.552890152401396, 'CAT_prices': 1546.8106758067811}, 'LAKE_prices': {'SUN_prices': 171.88246463451509, 'WWD_prices': 595.68338592130374, 'UTX_prices': 17.846451291850968, 'MCD_prices': 17.488445860420178, 'MSFT_prices': 18.421340453702641, 'ORCL_prices': 20.563608974880644, 'T_prices': 17.737006102667916}, 'UTX_prices': {'WWD_prices': 2334.2618138531452}, 'AEM_prices': {'LAKE_prices': 1370.9566980299608, 'APA_prices': 1325.6725059235018, 'SUN_prices': 908.95430824429377, 'AFG_prices': 729.14130747676677, 'WWD_prices': 508.8562587364047, 'T_prices': 763.87636443493409, 'UTX_prices': 958.16651332082313, 'MCD_prices': 890.70170084635413, 'MSFT_prices': 722.64949098474835, 'ORCL_prices': 655.95148594675504, 'B_prices': 690.13492812113043, 'CAT_prices': 1141.2369316150939}, 'T_prices': {'UTX_prices': 2870.7375134037989, 'WWD_prices': 97.096034280614916}, 'AAPL_prices': {'LAKE_prices': 4164.0697904898452, 'APA_prices': 2907.9094537473193, 'SUN_prices': 3114.6284471698837, 'ABT_prices': 2172.6699978697534, 'WWD_prices': 1501.9428230634701, 'AEM_prices': 2415.2244816399866, 'T_prices': 2833.5646099813625, 'UTX_prices': 823.20188419117642, 'AFG_prices': 1042.7630477207158, 'MSFT_prices': 2082.8878986433442, 'ORCL_prices': 2143.8520776686328, 'MCD_prices': 516.59077220243569, 'B_prices': 2285.9719073925144, 'CAT_prices': 1243.7147096322253}, 'AFG_prices': {'LAKE_prices': 1489.1567596635009, 'APA_prices': 1939.6501043581495, 'SUN_prices': 845.16594625236166, 'WWD_prices': 217.97825825510461, 'T_prices': 682.60933695774452, 'UTX_prices': 758.41483496965145, 'MCD_prices': 577.83871891794638, 'MSFT_prices': 365.51228368921215, 'ORCL_prices': 465.05982482511234, 'B_prices': 497.42655537923179, 'CAT_prices': 856.48478224012592}, 'MSFT_prices': {'ORCL_prices': 121.79641203038832, 'UTX_prices': 2031.8779998978757, 'WWD_prices': 39.873902165032682, 'SUN_prices': 408.94287260965586, 'T_prices': 133.47480584188224}, 'ORCL_prices': {'UTX_prices': 1078.6703723383885, 'WWD_prices': 35.124996322432374, 'SUN_prices': 429.23110012478298, 'T_prices': 156.80897398306652}, 'MCD_prices': {'SUN_prices': 3702.0659296172898, 'WWD_prices': 2340.6831118515115, 'UTX_prices': 289.99591365639679, 'MSFT_prices': 2702.7328142552592, 'ORCL_prices': 3007.2811057495915, 'T_prices': 3168.0861583435458}, 'IXIC_prices': {'LAKE_prices': 11900185.694117647, 'APA_prices': 11509975.466666667, 'SUN_prices': 11761567.790849673, 'ABT_prices': 11760489.981699346, 'UTX_prices': 11452685.903267974, 'WWD_prices': 11724974.546405228, 'AEM_prices': 11710095.937254902, 'T_prices': 11764206.907189542, 'AAPL_prices': 11536284.345098039, 'AFG_prices': 11667479.022222223, 'MSFT_prices': 11729596.214379085, 'ORCL_prices': 11771884.779084967, 'MCD_prices': 11461222.781699346, 'CAT_prices': 11497705.605228757, 'B_prices': 11781709.83006536}, 'B_prices': {'LAKE_prices': 401.02719351575263, 'SUN_prices': 339.57140508913528, 'WWD_prices': 62.742014292798011, 'T_prices': 162.01006646249809, 'UTX_prices': 673.85953109840943, 'MCD_prices': 455.47073336333233, 'MSFT_prices': 68.758829612981259, 'ORCL_prices': 54.721108270782274, 'CAT_prices': 1129.5602566987081}}

MSEGraphPath = "/home/achivuku/PycharmProjects/financedataanalysis/MSE-Graph.png"
QMEGraphPath = "/home/achivuku/PycharmProjects/financedataanalysis/QME-Graph.png"

MSEErrorsDataframePath = "/home/achivuku/PycharmProjects/financedataanalysis/MSEErrors-Graph.pkl"
QMEErrorsDataframePath = "/home/achivuku/PycharmProjects/financedataanalysis/QMEErrors-Graph.pkl"

MSEModelFstatMAEPath = "/home/achivuku/PycharmProjects/financedataanalysis/MSECauses-Graph.pkl"
QMEModelFstatMAEPath = "/home/achivuku/PycharmProjects/financedataanalysis/QMECauses-Graph.pkl"

numdecimalplaces = 3

def calculatefstatistic(nestedrd, nestedurd, colour):

    nestedfstat = collections.defaultdict(dict)
    G = nx.DiGraph()

    dfout = pd.DataFrame(columns=columns, index=indexes)

    for outerkey, outervalue in nestedrd.iteritems():
        for innerkey, innervalue in nestedrd[outerkey].iteritems():
            restrictederror = nestedrd[outerkey][innerkey]
            unrestrictederror = nestedurd[outerkey][innerkey]

            dfout.loc[outerkey][innerkey.replace("prices", "restricted")] = restrictederror
            dfout.loc[outerkey][innerkey.replace("prices", "unrestricted")] = unrestrictederror

            fstat = (restrictederror - unrestrictederror) / unrestrictederror

            if ( fstat > 0.05 ):
                nestedfstat[outerkey][innerkey] = fstat
                G.add_edge(innerkey.rstrip('_prices'), outerkey.rstrip('_prices'), color=colour, weight=round(fstat,numdecimalplaces))

    # print(G.edges(data=True))
    # sys.exit()
    # innerkey is granger influencing outerkey stock
    return nestedfstat, G, dfout

def plotskewedhistogram(stocskdf,stockname,colour,htype,filename):
    for c in stocskdf.columns.tolist()[1:]:
        ts = stocskdf[[c]]
        print(ts.skew())

    ts = stocskdf[[stockname]]
    tss = ts[stockname]
    # tss = ts.diff()[stockname]
    # tss[0] = 0

    # fig, ax = plt.subplots(figsize=(10, 8))

    tssh = tss.tolist()

    plt.figure()
    n, bins, patches = plt.hist(tssh,bins=100,alpha=0.75,histtype=htype, color=colour)

    xlabel(stockname.rstrip("_prices") + ' Price difference')
    ylabel(stockname.rstrip("_prices") + ' Price frequency')
    # plt.title(r'$\mathrm{Histogram\ of\ IQ:}\$')
    plt.grid(True)

    savefig(filename, dpi=300)

    # pyplot.hist(tssh2, bins1, alpha=0.5, color="blue", label='T')
    # width = 0.7 * (bins[1] - bins[0])
    # center = (bins[:-1] + bins[1:]) / 2
    # ax.bar(center2, hist2, align='center', width=width1,color="blue",label='T')

def savenetworkxgraph(modelgraph, nodecolour, SavePath):
    edge_labels = dict([((u, v,), d['weight'])
                        for u, v, d in modelgraph.edges(data=True)])
    plt.figure(figsize=(20,10), dpi=100, facecolor='w', edgecolor='k')
    graph_pos = nx.circular_layout(modelgraph)
    # graph_pos = nx.circular_layout(qmemodelgraph)
    nx.draw_networkx_edge_labels(modelgraph, graph_pos, edge_labels=edge_labels)
    nx.draw(modelgraph, graph_pos, node_size=1500, font_size=8, font_weight='bold', with_labels=True,
                     arrows=True, node_color=nodecolour)

    plt.tight_layout()
    plt.savefig(SavePath, format="PNG")

def findtstats(l1, l2):
    ttest = stats.ttest_ind(l1, l2, equal_var=True)
    print 't-statistic independent = %6.3f manipulated testing pvalue = ' % ttest[0], "{:.2e}".format(ttest[1])


# plotskewedhistogram(df,'AAPL_prices','green','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "AAPL" +".png")
# plotskewedhistogram(df,'ABT_prices','red','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "ABTs" +".png")
# plotskewedhistogram(df,'AEM_prices','blue','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "AEM" +".png")
# plotskewedhistogram(df,'AFG_prices','black','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "AFG" +".png")
#
# plotskewedhistogram(df,'APA_prices','green','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "APA" +".png")
# plotskewedhistogram(df,'CAT_prices','red','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "CAT" +".png")
# plotskewedhistogram(df,'LAKE_prices','blue','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "LAKE" +".png")
# plotskewedhistogram(df,'MCD_prices','black','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "MCD" +".png")
#
# plotskewedhistogram(df,'MSFT_prices','green','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "MSFT" +".png")
# plotskewedhistogram(df,'ORCL_prices','red','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "ORCL" +".png")
# plotskewedhistogram(df,'SUN_prices','blue','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "SUN" +".png")
# plotskewedhistogram(df,'T_prices','black','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "T" +".png")
#
# plotskewedhistogram(df,'UTX_prices','green','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "UTX" +".png")
# plotskewedhistogram(df,'WWD_prices','red','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "WWD" +".png")

# plotskewedhistogram(df,'AFG_prices','green','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "AFG" +".png")
# plotskewedhistogram(df,'T_prices','red','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "T" +".png")
# plotskewedhistogram(df,'AAPL_prices','blue','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "AAPL" +".png")
# plotskewedhistogram(df,'ORCL_prices','black','step',"/home/achivuku/PycharmProjects/financedataanalysis/"+ "ORCL" +".png")
# sys.exit()

msemodelfstatmae, msemodelgraph, mseerrorsframe = calculatefstatistic(msemodelrmae,msemodelurmae, 'green')
qmemodelfstatmae, qmemodelgraph, qmeerrorsframe = calculatefstatistic(qmemodelrmae,qmemodelurmae, 'red')

print('msemodelfstatmae',msemodelfstatmae)
print('qmemodelfstatmae',qmemodelfstatmae)

# ('qmemodelfstatmae', defaultdict(<type 'dict'>, {'CAT_prices': {'LAKE_prices': 2.9990296485142887, 'T_prices': 0.2415261771139126}, 'APA_prices': {'LAKE_prices': 2.9350827151399748, 'T_prices': 0.2701803743954868, 'B_prices': 0.2798289054983286}, 'ABT_prices': {'LAKE_prices': 0.5988416614972505}, 'AFG_prices': {'LAKE_prices': 2.208465617139271}, 'AEM_prices': {'LAKE_prices': 2.6596392607051054, 'T_prices': 0.18007565387249022, 'B_prices': 0.1726207887379092}, 'AAPL_prices': {'LAKE_prices': 6.642026855054242, 'SUN_prices': 0.8564413961773346, 'ABT_prices': 2.2840728129980192, 'AFG_prices': 0.29928000234246777, 'WWD_prices': 0.4212150303155039, 'AEM_prices': 0.8352981585545118, 'MCD_prices': 0.7077200976252324, 'MSFT_prices': 0.11115810688563488, 'ORCL_prices': 0.4605767245197249, 'B_prices': 1.4735249862022477, 'T_prices': 1.3727994939031125}, 'MCD_prices': {'ORCL_prices': 0.7722290648732423, 'SUN_prices': 1.1790321888136366, 'MSFT_prices': 0.24996869346684367, 'T_prices': 1.6751475233263127, 'WWD_prices': 0.603798246597676}, 'IXIC_prices': {'LAKE_prices': 300.0949856251977, 'CAT_prices': 12.881075723891486, 'APA_prices': 12.461251536744735, 'T_prices': 78.72479919416715, 'ABT_prices': 98.6990367554397, 'UTX_prices': 29.512446574104708, 'AFG_prices': 42.62349447417956, 'WWD_prices': 45.74702528991151, 'AEM_prices': 60.02641159961811, 'AAPL_prices': 26.625627782636187, 'MCD_prices': 55.04425747114812, 'MSFT_prices': 34.19810617501382, 'ORCL_prices': 51.8291676957156, 'B_prices': 81.79045092026263, 'SUN_prices': 68.56326465155462}, 'B_prices': {'LAKE_prices': 1.512494908559331}}))
# ('msemodelfstatmae', defaultdict(<type 'dict'>, {'UTX_prices': {'WWD_prices': 0.17098217553033543}, 'CAT_prices': {'ORCL_prices': 0.8187957585229688, 'LAKE_prices': 4.888523715022208, 'T_prices': 1.803260420387845, 'SUN_prices': 1.8332573315782354, 'WWD_prices': 0.18699646666044886}, 'APA_prices': {'ORCL_prices': 0.5207884386957298, 'LAKE_prices': 5.190654207852949, 'T_prices': 1.4093956434487138, 'SUN_prices': 0.8882164636825278, 'B_prices': 1.3637710201228903}, 'SUN_prices': {'T_prices': 0.4753646703836883}, 'ABT_prices': {'LAKE_prices': 3.5043729101268744, 'T_prices': 0.6347614964689184, 'AEM_prices': 0.1742994904357557, 'ORCL_prices': 0.2554533064626181, 'SUN_prices': 0.6694352687312496, 'B_prices': 0.4126958569891147}, 'AFG_prices': {'ORCL_prices': 0.421494559527839, 'LAKE_prices': 4.030640881109695, 'B_prices': 0.6089095844700808, 'T_prices': 0.6671301487602306, 'SUN_prices': 1.3563824260939688}, 'AEM_prices': {'LAKE_prices': 0.8086599384155568}, 'AAPL_prices': {'LAKE_prices': 4.755953068917847, 'T_prices': 1.0662155515443612, 'ABT_prices': 0.07547147046886388, 'AEM_prices': 1.0460720805864627, 'ORCL_prices': 0.44627383795014147, 'B_prices': 0.7922792490767873, 'SUN_prices': 1.2713923544894874}, 'MCD_prices': {'SUN_prices': 3.2651966183935706, 'WWD_prices': 0.9440778205584074, 'UTX_prices': 0.11115381244933568, 'MSFT_prices': 0.548360594894264, 'ORCL_prices': 1.8480374342318524, 'T_prices': 2.5874032973462535}, 'IXIC_prices': {'LAKE_prices': 118.36330516143713, 'CAT_prices': 12.984880922878757, 'APA_prices': 18.60977692291594, 'T_prices': 41.348232874851064, 'ABT_prices': 19.895479692526497, 'UTX_prices': 13.163384459398333, 'AFG_prices': 14.21649265244999, 'WWD_prices': 21.11588429255004, 'AEM_prices': 36.94697533047779, 'AAPL_prices': 8.466903207137525, 'MCD_prices': 9.232164188924152, 'MSFT_prices': 17.543535942677238, 'ORCL_prices': 33.14589515791778, 'B_prices': 42.842312922779485, 'SUN_prices': 42.94325628728047}, 'B_prices': {'LAKE_prices': 1.6624285361611508}}))


print('qmemodelgraph',qmemodelgraph.edges())
print('qmemodelgraph',qmemodelgraph.nodes())


# graph_pos=nx.circular_layout(msemodelgraph)
# nx.draw_networkx(msemodelgraph, graph_pos, node_size=1500, font_size=8, font_weight='bold', with_labels=True, arrows=True, node_color = 'green')
# plt.tight_layout()
# plt.savefig(MSEGraphPath, format="PNG")
savenetworkxgraph(msemodelgraph, 'green', MSEGraphPath)

# graph_pos = nx.circular_layout(qmemodelgraph)
# # graph_pos = nx.circular_layout(qmemodelgraph)
# nx.draw_networkx(qmemodelgraph, graph_pos, node_size=1500, font_size=8, font_weight='bold', with_labels=True, arrows=True, node_color = 'red')
# plt.tight_layout()
# plt.savefig(QMEGraphPath, format="PNG")
savenetworkxgraph(qmemodelgraph, 'red', QMEGraphPath)

# sys.exit()

mseerrorsframe.to_pickle(MSEErrorsDataframePath)
qmeerrorsframe.to_pickle(QMEErrorsDataframePath)
# QMEErrors = pd.read_pickle("QMEErrors-Graph.pkl")
# QMEErrors.loc['ABT_prices']['SUN_restricted']


with open(MSEModelFstatMAEPath, 'wb') as handle:
    pickle.dump(msemodelfstatmae,handle,protocol=pickle.HIGHEST_PROTOCOL)

with open(QMEModelFstatMAEPath, 'wb') as handle:
    pickle.dump(qmemodelfstatmae,handle,protocol=pickle.HIGHEST_PROTOCOL)
# handle1 = open("QMECauses-Graph.pkl", 'rb')
# QMECauses = pickle.load(handle1)
# QMECauses['B_prices']['LAKE_prices']

# Plot Options :
# https://networkx.github.io/documentation/networkx-1.10/reference/generated/networkx.drawing.nx_pylab.draw_networkx.html#networkx.drawing.nx_pylab.draw_networkx1
# https://www.udacity.com/wiki/creating-network-graphs-with-python
# TO DO : Remove duplicate vertices and add Ftest values as edge weights

# https://matplotlib.org/1.2.1/examples/pylab_examples/histogram_demo.html